<!DOCTYPE html>
<html lang="en">
<head>
    <title>ACIS examples</title>
    <meta charset="utf-8">
</head>
<body>
  <div id="geo-selector"></div>
  <div id="query-results"></div>
  
  <script src="../../build/build.js"></script>

  <script type="text/x-template" id="station-template">
    <div class="results">
      <div v-repeat="stn: stns | orderBy 'name'">
        {{stn.name}}
      </div>
    </div>
  </script>

  <script type="text/javascript">
    var request = require('superagent'),
        extend = require('extend'),
        Vue = require('vue');

    var geoSelector = new Vue(extend({el: '#geo-selector'}, require('geo-selector')));

    var stnLister = new Vue({
        el: '#query-results',
        template: "#station-template",

        data: {
          stns: []
        },
        
        ready: function () {
          geoSelector.$on('clear', this.clear)
          geoSelector.$on('params', this.stnload)
        },
        
        methods: {
          clear: function () {
            this.stns = []
          },
          
          stnload: function (query) {
            var self=this,
                params = {
                    "meta":["name","state","sids","uid","ll","valid_daterange"],
                    "elems":"maxt,mint,pcpn"
                    }
            params[query.gtype] = query.gid
            request
              .post('http://data.rcc-acis.org/StnMeta', params)
              .end(function(res){
                if (res.status == 200) {
                  if (res.body.error === undefined) stnLister.stns = res.body.meta
                  else console.log('invalid request %s', res.body.error)
                } else {
                  console.log('failed reqest %s',res.status)
                }
              })
          }
        }
    });

  </script>
</body>
</html>
